name: Deploy to AkileCloud

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Server
        uses: appleboy/ssh-action@master
        with:
          # ä¸‹é¢è¿™ä¸‰ä¸ªå˜é‡éœ€è¦åœ¨ Settings -> Secrets é‡Œé…ç½®
          host: ${{ secrets.SERVER_IP }}
          username: root
          password: ${{ secrets.SERVER_PASSWORD }}
          port: 22
          script: |
            # 1. è¿›å…¥ä½ åˆšæ‰æ‰‹åŠ¨åˆ›å»ºçš„ç›®å½•
            cd /root/stockwise
            
            # 2. æ‹‰å–æœ€æ–°ä»£ç 
            # (å› ä¸ºæˆ‘ä»¬ä¹‹å‰å¼ºåˆ¶æŠŠå®ƒè·Ÿæ–°ä»“åº“å…³è”äº†ï¼Œæ‰€ä»¥è¿™é‡Œæ‹‰çš„å°±æ˜¯æ–°ä»£ç )
            git fetch --all
            git reset --hard origin/main
            git pull
            
            # 3. å®‰è£…ä¾èµ–å¹¶æ‰“åŒ…
            npm install
            npm run build
            
            # 4. éƒ¨ç½²åˆ° Nginx ç›®å½• (æ¸…ç©ºæ—§çš„ï¼Œæ”¾å…¥æ–°çš„)
            rm -rf /root/vet-app/html/*
            cp -r dist/* /root/vet-app/html/
            
            echo "Deployment Successful! ğŸ‰"
